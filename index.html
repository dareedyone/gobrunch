<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go brunch</title>
    <style>
        svg {
            border: 2px solid burlywood;
            /* background-image: "url('./assets/svgs/index.jpeg')"; */
        }

        button {
            padding: 5px;
            background-color: rgb(58, 58, 194);
            color: white;
        }

        .seat {
            fill: rgb(240, 238, 236);
        }
    </style>
    <script src="./assets/Snap.svg-0.5.1/dist/snap.svg-min.js"></script>
</head>

<body>
    <div id="container">
        <div>
            <button id="add-circle">Add Circle</button>
            <button id="end-creating">End Creating</button>
        </div>

        <svg id="svg" viewBox="0 0 1370 1170" xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www/w3.org/1999/xlink">

            <!-- for future usage we can make image dynamic -->
            <!-- <image id="image-svg" href="./assets/svgs/index.jpeg" x="0" y="0" height="770.625" width="1370" /> -->
        </svg>

    </div>




    <script>
        let editing = false;
        const DOMSvg = document.getElementById("svg");
        // const ImageSvg = document.getElementById("svg");
        const svg = Snap("#svg");

        // Dom elements
        const addCircleButton = document.getElementById("add-circle");
        const endCreatingButton = document.getElementById("end-creating");


        // listeners
        addCircleButton.addEventListener("click", () => {
            document.body.style.cursor = "crosshair";
            editing = true;
        });

        endCreatingButton.addEventListener("click", () => {
            document.body.style.cursor = "default";
            editing = false;
        });

        DOMSvg.addEventListener("click", (event) => {
            if (editing) {
                const rect = event.target.getBoundingClientRect();
                // console.log("the rect", rect);
                // console.log("the client", event.clientX, event.clientY);
                const X = event.offsetX;
                const Y = event.offsetY;
                const rectWidthOneOfHundred = rect.width / 100;
                const rectHeightOneOfHundred = rect.height / 100;
                const radius = 37;

                const offsetXPercentage = X / rectWidthOneOfHundred;
                const offsetYPercentage = Y / rectHeightOneOfHundred;
                const amountXFromRadius = radius * (offsetXPercentage / 100);
                const amountYFromRadius = radius * (offsetYPercentage / 100);


                // console.log("xx", offsetXPercentage, amountXFromRadius);
                // console.log("yy", offsetYPercentage, amountYFromRadius);

                const x = X + amountXFromRadius;  //x position within the element.
                const y = Y + amountYFromRadius  //y position within the element.
                // const x = event.clientX - rect.left //x position within the element.
                // const y = event.clientY - rect.top;  //y position within the element.

                const rightLeftBottomLimit = radius + 20 // 20 is the constant given;
                const leftBoundaryLimit = rightLeftBottomLimit;
                const topBoundaryLimit = 50;
                const rightBoundaryLimit = rect.width - rightLeftBottomLimit;
                const bottomBoundaryLimit = rect.height - rightLeftBottomLimit;
                const limitCheck = x >= leftBoundaryLimit && x <= rightBoundaryLimit && y >= topBoundaryLimit && y <= bottomBoundaryLimit;

                if (limitCheck) {
                    createSeat(x, y, radius);
                } else {
                    // can do some cool warning error animations
                    console.log("out of boundary");
                }



            }
        })


        // for test 
        // DOMSvg.addEventListener("mousemove", (event) => {
        //     console.log("------------------------");
        //     const rect = event.target.getBoundingClientRect();
        //     console.log("the rect", rect);
        //     console.log("offset", event.offsetX, event.offsetY);
        //     console.log("page", event.pageX, event.pageY);
        //     console.log("client", event.clientX, event.clientY);
        // })



        // Functions
        const createSeat = (x, y, radius) => {
            // TODO  consider class if further actions 
            const seat = svg.circle(x, y, radius);
            seat.attr({
                class: "seat",
                // id: "seat-1",


            })
        }
    </script>
</body>

</html>